<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DigiKipp – Start</title>

  <style>
    :root{
      --cols: 8;
      --cell: 142px;

      --scale: 1;
      --uiscale: 1;
      --gridW: calc(var(--cols) * var(--cell));
      --gridH: 100vh;

      --ui-panel-bg: #4a2418;
      --ui-text: #ead7be;
      --btn-bg: #ead7be;
      --btn-text: #2a160c;

      --bg-off-x: 0px;
      --bg-off-y: 0px;
    }

    html, body{
      height: 100%;
      margin: 0;
      overflow: hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      touch-action: manipulation;
      background: #000;
    }

    body{
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }

    .stage{
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    .layout{
      position: absolute;
      left: 50%;
      top: 0;
      width: var(--gridW);
      height: var(--gridH);
      transform-origin: top center;
      transform: translateX(-50%) scale(var(--scale));
    }

    /* Hintergrund – deine Startseite */
    .bgPNG{
      position:absolute;
      left: 0;
      top: 0;
      width: var(--gridW);
      height: var(--gridH);
      background-image: url("digikipp_starts.png");
      background-repeat: no-repeat;
      background-size: 100% auto;
      background-position:
        calc(0px + var(--bg-off-x))
        calc(0px + var(--bg-off-y));
      pointer-events:none;
      z-index:0;
    }

    .uiLayer{
      position:absolute;
      left:0;
      top:0;
      width:var(--gridW);
      height:var(--gridH);
      z-index:10;
      pointer-events:none;
    }

    /* Button-Stil wie im Spiel (squareBtn + startBtn) */
    .squareBtn{
      width: calc(520px * var(--uiscale));
      max-width: calc(6 * var(--cell));
      height: calc(44px * var(--uiscale));
      border-radius: calc(14px * var(--uiscale));
      border: 2px solid rgba(0,0,0,0.65);
      background: rgba(234,215,190,0.96);
      box-shadow:
        0 10px 18px rgba(0,0,0,0.22),
        0 0 0 1px rgba(255,255,255,0.18) inset;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
      pointer-events:auto;
      touch-action: manipulation;
    }
    .squareBtn:active{
      /* transform wird von .menu-btn:active überschrieben */
    }

    .startBtnText{
      font-weight: 1000;
      letter-spacing: 0.06em;
      color: #7a3f2b;
      text-shadow: 0 1px 0 rgba(255,255,255,0.35);
      font-size: calc(18px * var(--uiscale));
      line-height:1;
      text-transform:uppercase;
    }

    /* Positionierung der drei Buttons im Raster */
    .menu-btn{
      position:absolute;
      left:50%;
      transform:translate(-50%, -50%);
    }
    .menu-btn:active{
      transform:translate(-50%, -50%) scale(0.98);
      filter: brightness(0.98);
    }

    /* Plätze (Zeilen) werden per JS gesetzt, Klassen bleiben leer */

    /* Inaktiver Fairy-Button */
    .fairyBtn{
      background:#dcd2c7;
      color:#9c938b;
      box-shadow:none;
      opacity:0.55;
      cursor:default;
    }

    /* Navigation Button (X-Icon) */
    .navBtn{
      position: absolute;
      width: calc(56px * var(--uiscale));
      height: calc(56px * var(--uiscale));
      background: none;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      pointer-events: auto;
      z-index: 100;
      transition: transform 0.12s ease, opacity 0.12s ease;
    }
    .navBtn:active{ transform: scale(0.95); opacity: 0.8; }

    .closeIcon{
      position: relative;
      width: calc(32px * var(--uiscale));
      height: calc(32px * var(--uiscale));
    }
    .closeIcon::before,
    .closeIcon::after{
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: calc(32px * var(--uiscale));
      height: calc(5px * var(--uiscale));
      background: rgba(234,215,190,0.96);
      border-radius: calc(2.5px * var(--uiscale));
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.45));
    }
    .closeIcon::before{ transform: translate(-50%, -50%) rotate(45deg); }
    .closeIcon::after { transform: translate(-50%, -50%) rotate(-45deg); }

    /* Modal für Schließen-Bestätigung */
    .modalOverlay{
      position:fixed;
      left:0;
      top:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.75);
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
      backdrop-filter:blur(4px);
      opacity:1;
      transition:opacity 0.2s ease;
    }
    .modalOverlay.hidden{
      opacity:0;
      pointer-events:none;
    }

    .modalBox{
      background: var(--btn-bg);
      border-radius: 18px;
      padding: 32px 28px;
      max-width: 90vw;
      width: 420px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      text-align:center;
    }

    .modalTitle{
      font-size: clamp(18px, 5vw, 24px);
      font-weight:1000;
      color: var(--btn-text);
      margin-bottom: 16px;
      letter-spacing:0.02em;
    }

    .modalText{
      font-size: clamp(14px, 4vw, 16px);
      color: #5a3a28;
      margin-bottom: 26px;
      line-height:1.5;
    }

    .modalBtns{
      display:flex;
      gap: 12px;
      justify-content:center;
    }

    .modalBtn{
      padding: 12px 24px;
      border-radius: 10px;
      border:2px solid rgba(0,0,0,0.25);
      font-weight:700;
      font-size: clamp(14px, 4vw, 16px);
      cursor:pointer;
      transition:all 0.12s ease;
      user-select:none;
    }
    .modalBtn:active{ transform:scale(0.97); }

    .modalBtn.cancel{
      background:#fff;
      color:#5a3a28;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
    }

    .modalBtn.confirm{
      background:#8a4f35;
      color:#fff;
      box-shadow:0 2px 8px rgba(0,0,0,0.25);
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="layout" id="layout">
      <div class="bgPNG" aria-hidden="true"></div>

      <div class="uiLayer">
        <!-- Button 1 – KIPP COLOR -->
        <button id="btnColor" class="squareBtn menu-btn">
          <span class="startBtnText">KIPP COLOR</span>
        </button>

        <!-- Button 2 – KIPP CARD -->
        <button id="btnCard" class="squareBtn menu-btn">
          <span class="startBtnText">KIPP CARD</span>
        </button>

        <!-- Button 3 – KIPP FAIRY (inaktiv) -->
        <button id="btnFairy" class="squareBtn menu-btn fairyBtn" disabled>
          <span class="startBtnText">KIPP FAIRY</span>
        </button>

        <!-- Schließen Button -->
        <button class="navBtn" id="closeBtn" aria-label="App beenden">
          <div class="closeIcon"></div>
        </button>
      </div>
    </div>
  </div>

  <div id="closeModal" class="modalOverlay hidden">
    <div class="modalBox">
      <div class="modalTitle">App beenden?</div>
      <div class="modalText">Möchtest du DigiKipp wirklich schließen?</div>
      <div class="modalBtns">
        <button class="modalBtn cancel" id="modalCancel">Abbrechen</button>
        <button class="modalBtn confirm" id="modalConfirm">Beenden</button>
      </div>
    </div>
  </div>

  <script>
    const HEADER_ROW_OFFSET = 2;

    function numVar(name){
      return parseFloat(
        getComputedStyle(document.documentElement).getPropertyValue(name)
      ) || 0;
    }

    function setScaleToFitWidth(){
      const cols = numVar("--cols") || 8;
      const cell = numVar("--cell") || 142;

      const gridW = cols * cell;
      const vw = window.innerWidth;

      const targetW = vw * 0.94;
      const scale = Math.min(1, targetW / gridW);

      document.documentElement.style.setProperty("--scale", scale.toFixed(4));
      document.documentElement.style.setProperty("--gridW", gridW + "px");

      const uiscale = 1 / (scale || 1);
      document.documentElement.style.setProperty("--uiscale", uiscale.toFixed(4));

      return { cell, scale, gridW };
    }

    function positionUI(){
      const cellPx = numVar("--cell") || 142;

      const btnColor = document.getElementById("btnColor");
      const btnCard  = document.getElementById("btnCard");
      const btnFairy = document.getElementById("btnFairy");

      // Zeile 10
      const row10CenterY = (((10 + HEADER_ROW_OFFSET) - 1) * cellPx) + cellPx/2;
      // Zwischen Zeile 11 und 12 → 11,5
      const row115CenterY = (((11.5 + HEADER_ROW_OFFSET) - 1) * cellPx) + cellPx/2;
      // Zeile 13
      const row13CenterY = (((13 + HEADER_ROW_OFFSET) - 1) * cellPx) + cellPx/2;

      btnColor.style.top = row10CenterY + "px";
      btnCard.style.top  = row115CenterY + "px";
      btnFairy.style.top = row13CenterY + "px";

      // Position Close Button in Rasterzelle 0.1A
      const closeBtn = document.getElementById("closeBtn");
      const closeLeft = cellPx * 0.5;
      const closeTop = cellPx * 0.5;
      
      closeBtn.style.left = closeLeft + "px";
      closeBtn.style.top = closeTop + "px";
      closeBtn.style.transform = "translate(-50%, -50%)";
    }

    function rebuild(){
      const { cell, scale } = setScaleToFitWidth();

      const vh = window.innerHeight;
      const effectiveLayoutHeight = vh / (scale || 1);
      const rows = Math.ceil(effectiveLayoutHeight / cell) + 1;
      const gridH = rows * cell;
      document.documentElement.style.setProperty("--gridH", gridH + "px");

      positionUI();
    }

    window.addEventListener("load", rebuild);
    window.addEventListener("resize", rebuild);

    // Navigation (falls gewünscht)
    const btnColor = document.getElementById("btnColor");
    const btnCard  = document.getElementById("btnCard");

    function navigateToGame(url) {
      window.location.href = url;
    }

    btnColor.addEventListener("click", (e) => {
      e.preventDefault();
      navigateToGame("kipp-color.html");
    }, { passive: false });

    btnCard.addEventListener("click", (e) => {
      e.preventDefault();
      navigateToGame("kipp-card.html");
    }, { passive: false });

    // Close Modal Funktionalität
    const closeBtn = document.getElementById("closeBtn");
    const closeModal = document.getElementById("closeModal");
    const modalCancel = document.getElementById("modalCancel");
    const modalConfirm = document.getElementById("modalConfirm");

    function showCloseModal() {
      closeModal.classList.remove("hidden");
    }

    function hideCloseModal() {
      closeModal.classList.add("hidden");
    }

    function closeApp() {
      // Versuche App/Tab zu schließen
      window.close();
      
      // Fallback für Browser die window.close() blockieren
      setTimeout(() => {
        // Wenn Tab noch offen ist, gehe zurück oder zu about:blank
        if (!document.hidden) {
          window.history.back();
        }
      }, 100);
    }

    closeBtn.addEventListener("click", showCloseModal);
    modalCancel.addEventListener("click", hideCloseModal);
    modalConfirm.addEventListener("click", closeApp);

    // Modal schließen bei Klick außerhalb
    closeModal.addEventListener("click", (e) => {
      if (e.target === closeModal) {
        hideCloseModal();
      }
    });
  </script>
</body>
</html>
