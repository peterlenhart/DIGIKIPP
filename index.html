<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DigiKipp – Start</title>
  
  <!-- Web App Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  
  <!-- iOS Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="DigiKipp">
  <link rel="apple-touch-icon" href="icon-192.png">
  
  <!-- Theme Color -->
  <meta name="theme-color" content="#4a2418">

  <style>
    :root{
      --cols: 8;
      --cell: 142px;

      --scale: 1;
      --uiscale: 1;
      --gridW: calc(var(--cols) * var(--cell));
      --gridH: 100vh;

      --ui-panel-bg: #4a2418;
      --ui-text: #ead7be;
      --btn-bg: #ead7be;
      --btn-text: #2a160c;

      --bg-off-x: 0px;
      --bg-off-y: 0px;
    }

    html, body{
      height: 100%;
      margin: 0;
      overflow: hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      touch-action: manipulation;
      background: #000;
    }

    body{
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }

    .stage{
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    .layout{
      position: absolute;
      left: 50%;
      top: 0;
      width: var(--gridW);
      height: var(--gridH);
      transform-origin: top center;
      transform: translateX(-50%) scale(var(--scale));
    }

    /* Hintergrund – Startscreen PNG */
    .bgPNG{
      position:absolute;
      left: 0;
      top: 0;
      width: var(--gridW);
      height: var(--gridH);
      background-image: url("digikipp_starts.png");
      background-repeat: no-repeat;
      background-size: 100% auto;
      background-position:
        calc(0px + var(--bg-off-x))
        calc(0px + var(--bg-off-y));
      pointer-events:none;
      z-index:0;
    }

    .uiLayer{
      position:absolute;
      left:0;
      top:0;
      width:var(--gridW);
      height:var(--gridH);
      z-index:10;
      pointer-events:none;
    }

    /* Standard-Buttons */
    .squareBtn{
      width: calc(520px * var(--uiscale));
      max-width: calc(6 * var(--cell));
      height: calc(44px * var(--uiscale));
      border-radius: calc(14px * var(--uiscale));
      border: 2px solid rgba(0,0,0,0.65);
      background: rgba(234,215,190,0.96);
      box-shadow:
        0 10px 18px rgba(0,0,0,0.22),
        0 0 0 1px rgba(255,255,255,0.18) inset;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
      pointer-events:auto;
      touch-action: manipulation;
    }

    .startBtnText{
      font-weight: 1000;
      letter-spacing: 0.06em;
      color: #7a3f2b;
      text-shadow: 0 1px 0 rgba(255,255,255,0.35);
      font-size: calc(18px * var(--uiscale));
      line-height:1;
      text-transform:uppercase;
    }

    /* Button Reihen 10–13 */
    .menu-btn{
      position:absolute;
      left:50%;
      transform:translate(-50%, -50%);
    }

    .fairyBtn{
      background:#dcd2c7;
      color:#9c938b;
      box-shadow:none;
      opacity:0.55;
      cursor:default;
    }

    /* Navigation Buttons (X + Share) */
    .navBtn{
      position: absolute;
      width: calc(56px * var(--uiscale));
      height: calc(56px * var(--uiscale));
      background: none;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      pointer-events: auto;
      z-index: 100;
      transition: transform 0.12s ease, opacity 0.12s ease;
    }

    .navBtn:active{
      transform: scale(0.95);
      opacity:0.8;
    }

    /* X-Icon */
    .closeIcon{
      position: relative;
      width: calc(32px * var(--uiscale));
      height: calc(32px * var(--uiscale));
    }

    .closeIcon::before,
    .closeIcon::after{
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: calc(32px * var(--uiscale));
      height: calc(5px * var(--uiscale));
      background: rgba(234,215,190,0.96);
      border-radius: calc(2.5px * var(--uiscale));
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.45));
    }

    .closeIcon::before{ transform: translate(-50%, -50%) rotate(45deg); }
    .closeIcon::after { transform: translate(-50%, -50%) rotate(-45deg); }

    /* FERTIGES Share-Icon als SVG */
    .shareSvg{
      width: calc(28px * var(--uiscale));
      height: calc(28px * var(--uiscale));
    }

    .shareSvg circle{
      fill: rgba(234,215,190,0.96);
      stroke: rgba(234,215,190,0.96);
      stroke-width: 2.4;
    }

    .shareSvg line{
      stroke: rgba(234,215,190,0.96);
      stroke-width: 2.4;
      stroke-linecap: round;
    }

    /* Paragraph (§) Icon */
    .legalIcon{
      width: calc(32px * var(--uiscale));
      height: calc(32px * var(--uiscale));
      border-radius: 50%;
      background: rgba(234,215,190,0.96);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: calc(20px * var(--uiscale));
      font-weight: 700;
      color: #7a3f2b;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.45));
      line-height: 0.9;
      position: relative;
    }

    .legalIcon::before{
      content: "§";
      position: absolute;
      top: 48%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* Modal */
    .modalOverlay{
      position:fixed;
      left:0;
      top:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.75);
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
      backdrop-filter:blur(4px);
      opacity:1;
      transition:opacity 0.2s ease;
    }

    .modalOverlay.hidden{
      opacity:0;
      pointer-events:none;
    }

    #modalContainer{
      position:relative;
      pointer-events:auto;
    }

    #modalImage{
      display:block;
      pointer-events:none;
    }

    .modalClickArea{
      position:absolute;
      cursor:pointer;
      pointer-events:auto;
    }

  </style>
</head>

<body>
  <div class="stage">
    <div class="layout" id="layout">
      <div class="bgPNG"></div>

      <div class="uiLayer">

        <!-- Buttons -->
        <button id="btnColor" class="squareBtn menu-btn">
          <span class="startBtnText">KIPP COLOR</span>
        </button>

        <!-- KIPP CARD -->
        <button id="btnCard" class="squareBtn menu-btn">
          <span class="startBtnText">KIPP CARD</span>
        </button>

        <!-- KIPP QUEEN (inaktiv) -->
        <button id="btnQueen" class="squareBtn menu-btn fairyBtn" disabled>
          <span class="startBtnText">KIPP QUEEN</span>
        </button>

        <!-- KIPP KING (inaktiv) -->
        <button id="btnKing" class="squareBtn menu-btn fairyBtn" disabled>
          <span class="startBtnText">KIPP KING</span>
        </button>

        <!-- X -->
        <button class="navBtn" id="closeBtn" aria-label="App beenden">
          <div class="closeIcon"></div>
        </button>

        <!-- TEILEN -->
        <button class="navBtn" id="shareBtn" aria-label="Teilen">
          <svg class="shareSvg" viewBox="0 0 24 24" aria-hidden="true">
            <!-- drei Punkte -->
            <circle cx="18" cy="6" r="2.4" />
            <circle cx="6"  cy="12" r="2.4" />
            <circle cx="18" cy="18" r="2.4" />
            <!-- Verbindungs-Linien -->
            <line x1="8.4" y1="12" x2="15.6" y2="7.8" />
            <line x1="8.4" y1="12" x2="15.6" y2="16.2" />
          </svg>
        </button>

        <!-- LEGAL (§) -->
        <button class="navBtn" id="legalBtn" aria-label="Impressum & Datenschutz">
          <div class="legalIcon"></div>
        </button>

      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="closeModal" class="modalOverlay hidden">
    <div id="modalContainer">
      <img src="sicherheitsabfrage.webp" id="modalImage" alt="Sicherheitsabfrage">
      <div id="modalAbbrechen" class="modalClickArea"></div>
      <div id="modalBeenden" class="modalClickArea"></div>
    </div>
  </div>

  <script>

    const HEADER_ROW_OFFSET = 2;

    function numVar(name){
      return parseFloat(
        getComputedStyle(document.documentElement).getPropertyValue(name)
      ) || 0;
    }

    function setScaleToFitWidth(){
      const cols = numVar("--cols") || 8;
      const cell = numVar("--cell") || 142;

      const gridW = cols * cell;
      const vw = window.innerWidth;

      const targetW = vw * 0.94;
      const scale = Math.min(1, targetW / gridW);

      document.documentElement.style.setProperty("--scale", scale.toFixed(4));
      document.documentElement.style.setProperty("--gridW", gridW + "px");

      const uiscale = 1 / (scale || 1);
      document.documentElement.style.setProperty("--uiscale", uiscale.toFixed(4));

      return { cell, scale, gridW };
    }

    function positionUI(){
      const cellPx = numVar("--cell") || 142;

      const btnColor = document.getElementById("btnColor");
      const btnCard  = document.getElementById("btnCard");
      const btnQueen = document.getElementById("btnQueen");
      const btnKing  = document.getElementById("btnKing");

      const row95  = (((9.5  + HEADER_ROW_OFFSET) - 1) * cellPx) + cellPx/2;
      const row11  = (((11   + HEADER_ROW_OFFSET) - 1) * cellPx) + cellPx/2;
      const row125 = (((12.5 + HEADER_ROW_OFFSET) - 1) * cellPx) + cellPx/2;
      const row14  = (((14   + HEADER_ROW_OFFSET) - 1) * cellPx) + cellPx/2;

      btnColor.style.top = row95  + "px";
      btnCard.style.top  = row11  + "px";
      btnQueen.style.top = row125 + "px";
      btnKing.style.top  = row14  + "px";

      // Close Button links (0.1A)
      const closeBtn = document.getElementById("closeBtn");
      const closeLeft = cellPx * 0.5;
      const closeTop  = cellPx * 0.5;
      closeBtn.style.left = closeLeft + "px";
      closeBtn.style.top  = closeTop  + "px";
      closeBtn.style.transform = "translate(-50%, -50%)";

      // Share Button rechts gespiegelt (0.1H)
      const shareBtn = document.getElementById("shareBtn");
      const shareLeft = cellPx * (8 - 0.5);
      shareBtn.style.left = shareLeft + "px";
      shareBtn.style.top  = closeTop + "px";
      shareBtn.style.transform = "translate(-50%, -50%)";

      // Legal (§) Button unter Share-Button
      const legalBtn = document.getElementById("legalBtn");
      const legalTop = cellPx * 1.2 + 70;
      legalBtn.style.left = shareLeft + "px";
      legalBtn.style.top  = legalTop + "px";
      legalBtn.style.transform = "translate(-50%, -50%)";

      // Modal positioning
      positionModal();
    }

    function positionModal(){
      const cellPx = numVar("--cell") || 142;
      const scale = numVar("--scale") || 1;
      
      const modalContainer = document.getElementById("modalContainer");
      const modalImage = document.getElementById("modalImage");
      const modalAbbrechen = document.getElementById("modalAbbrechen");
      const modalBeenden = document.getElementById("modalBeenden");
      
      // Container skalieren
      modalContainer.style.transform = `scale(${scale})`;
      
      // Klickbereiche relativ zum Bild
      // Zeile 8 (mit Header offset: Zeile 10 absolut)
      const row8Top = ((8 + HEADER_ROW_OFFSET - 1) * cellPx);
      
      // Abbrechen: halbe Spalte B (1.5) bis Ende Spalte D (4)
      const abbrechenLeft = cellPx * 1.5;
      const abbrechenWidth = cellPx * 2.5;
      
      modalAbbrechen.style.left = abbrechenLeft + "px";
      modalAbbrechen.style.top = row8Top + "px";
      modalAbbrechen.style.width = abbrechenWidth + "px";
      modalAbbrechen.style.height = cellPx + "px";
      
      // Beenden: Spalte E (4) bis halbe Spalte G (6.5)
      const beendenLeft = cellPx * 4;
      const beendenWidth = cellPx * 2.5;
      
      modalBeenden.style.left = beendenLeft + "px";
      modalBeenden.style.top = row8Top + "px";
      modalBeenden.style.width = beendenWidth + "px";
      modalBeenden.style.height = cellPx + "px";
    }

    function rebuild(){
      const { cell, scale } = setScaleToFitWidth();
      const vh = window.innerHeight;
      const effective = vh / (scale || 1);
      const rows = Math.ceil(effective / cell) + 1;
      const gridH = rows * cell;
      document.documentElement.style.setProperty("--gridH", gridH + "px");
      positionUI();
    }

    window.addEventListener("load", rebuild);
    window.addEventListener("resize", rebuild);

    // Game navigation
    document.getElementById("btnColor").onclick = () => location.href="kipp-color.html";
    document.getElementById("btnCard").onclick  = () => location.href="kipp-card.html";
    // btnQueen und btnKing sind inaktiv (disabled)

    // Modal
    const closeBtn = document.getElementById("closeBtn");
    const closeModal = document.getElementById("closeModal");

    closeBtn.onclick = () => closeModal.classList.remove("hidden");
    document.getElementById("modalAbbrechen").onclick = () => closeModal.classList.add("hidden");
    document.getElementById("modalBeenden").onclick = () => location.href="tschuess.html";

    closeModal.onclick = (e) => { if(e.target === closeModal) closeModal.classList.add("hidden"); };

    // Teilen
    function shareApp(){
      const url = window.location.href;
      const text = "DigiKipp – schau mal vorbei!";

      if(navigator.share){
        navigator.share({ title:"DigiKipp", text, url }).catch(()=>{});
      } else {
        window.open("https://wa.me/?text=" + encodeURIComponent(text + " " + url), "_blank");
      }
    }

    document.getElementById("shareBtn").onclick = shareApp;

    // Legal (§) Button
    document.getElementById("legalBtn").onclick = () => {
      window.open("legal.html", "_blank");
    };

  </script>
</body>
</html>
